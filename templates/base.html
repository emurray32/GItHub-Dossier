<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Lead Machine{% endblock %}</title>
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><circle cx='50' cy='50' r='45' fill='%234F46E5'/><circle cx='50' cy='50' r='30' fill='none' stroke='white' stroke-width='4'/><line x1='71' y1='71' x2='90' y2='90' stroke='white' stroke-width='8' stroke-linecap='round'/></svg>">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/geist@1/dist/fonts/geist-sans/style.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}?v=2">
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.min.js"></script>
    {% block head %}{% endblock %}
</head>
<body>
    <a href="#main-content" class="skip-link">Skip to main content</a>

    <div class="app-layout">
        <!-- Sidebar Navigation -->
        <aside class="sidebar" id="sidebar" role="navigation" aria-label="Main navigation">
            <div class="sidebar-header">
                <a href="{{ url_for('accounts') }}" class="sidebar-brand">
                    <svg class="sidebar-brand-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                        stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                        <circle cx="11" cy="11" r="7"></circle>
                        <line x1="16.65" y1="16.65" x2="21" y2="21"></line>
                    </svg>
                    <span class="sidebar-brand-text">Lead Machine</span>
                </a>
                <button class="sidebar-toggle" id="sidebarToggle" aria-label="Toggle sidebar">
                    <i data-lucide="panel-left-close" class="sidebar-toggle-icon"></i>
                </button>
            </div>

            <nav class="sidebar-nav">
                <a href="{{ url_for('accounts') }}" class="sidebar-item {% if request.endpoint == 'accounts' %}active{% endif %}">
                    <i data-lucide="radar" class="sidebar-icon"></i>
                    <span class="sidebar-label">RepoRadar</span>
                </a>
                <a href="{{ url_for('campaigns') }}" class="sidebar-item {% if request.endpoint == 'campaigns' %}active{% endif %}">
                    <i data-lucide="send" class="sidebar-icon"></i>
                    <span class="sidebar-label">Campaigns</span>
                </a>
                <a href="{{ url_for('contributors') }}" class="sidebar-item {% if request.endpoint == 'contributors' %}active{% endif %}">
                    <i data-lucide="users" class="sidebar-icon"></i>
                    <span class="sidebar-label">Contributors</span>
                </a>
                <a href="{{ url_for('grow') }}" class="sidebar-item {% if request.endpoint == 'grow' %}active{% endif %}">
                    <i data-lucide="trending-up" class="sidebar-icon"></i>
                    <span class="sidebar-label">Grow</span>
                </a>
                <a href="{{ url_for('linkedin_prospector') }}" class="sidebar-item {% if request.endpoint == 'linkedin_prospector' %}active{% endif %}">
                    <i data-lucide="linkedin" class="sidebar-icon"></i>
                    <span class="sidebar-label">LinkedIn Prospector</span>
                </a>
                <a href="{{ url_for('settings') }}" class="sidebar-item {% if request.endpoint == 'settings' %}active{% endif %}">
                    <i data-lucide="settings" class="sidebar-icon"></i>
                    <span class="sidebar-label">Settings</span>
                </a>
            </nav>

            <!-- Map Sequence (quick action) -->
            <div class="sidebar-section">
                <div class="sidebar-section-header">
                    <span class="sidebar-section-label">Outbound Portal</span>
                </div>
                <a href="{{ url_for('scorecard') }}" class="sidebar-item {% if request.endpoint == 'scorecard' %}active{% endif %}">
                    <i data-lucide="award" class="sidebar-icon"></i>
                    <span class="sidebar-label">ScoreCard</span>
                </a>
            </div>
        </aside>

        <!-- Main Area -->
        <div class="main-area">
            <header class="top-header">
                <h2 class="top-header-title">{% block page_title %}Lead Machine{% endblock %}</h2>
                <div class="top-header-right">
                    {% block header_search %}{% endblock %}
                    <div class="top-header-avatar" title="Eric Murray">EM</div>
                </div>
            </header>
            {% block breadcrumb %}{% endblock %}
            <main class="main-content" id="main-content">
                {% block content %}{% endblock %}
            </main>
        </div>
    </div>

    <script>
        function timeAgo(dateString) {
            const date = new Date(dateString);
            if (Number.isNaN(date.getTime())) {
                return dateString;
            }

            const seconds = Math.floor((Date.now() - date.getTime()) / 1000);
            if (seconds < 60) return `${Math.max(seconds, 1)} sec${seconds === 1 ? '' : 's'} ago`;

            const minutes = Math.floor(seconds / 60);
            if (minutes < 60) return `${minutes} min${minutes === 1 ? '' : 's'} ago`;

            const hours = Math.floor(minutes / 60);
            if (hours < 24) return `${hours} hour${hours === 1 ? '' : 's'} ago`;

            const days = Math.floor(hours / 24);
            if (days < 30) return `${days} day${days === 1 ? '' : 's'} ago`;

            const months = Math.floor(days / 30);
            if (months < 12) return `${months} month${months === 1 ? '' : 's'} ago`;

            const years = Math.floor(months / 12);
            return `${years} year${years === 1 ? '' : 's'} ago`;
        }

        document.addEventListener('DOMContentLoaded', () => {
            document.querySelectorAll('.scanned-time').forEach((element) => {
                const dateString = element.dataset.iso || element.textContent.trim();
                element.textContent = timeAgo(dateString);
            });

            if (typeof lucide !== 'undefined') {
                lucide.createIcons();
            }

            // Sidebar collapse toggle
            const sidebar = document.getElementById('sidebar');
            const toggle = document.getElementById('sidebarToggle');
            const collapsed = localStorage.getItem('sidebar-collapsed') === 'true';

            if (collapsed) {
                sidebar.classList.add('collapsed');
            }

            if (toggle) {
                toggle.addEventListener('click', () => {
                    sidebar.classList.toggle('collapsed');
                    localStorage.setItem('sidebar-collapsed', sidebar.classList.contains('collapsed'));
                    if (typeof lucide !== 'undefined') {
                        lucide.createIcons();
                    }
                });
            }
        });

        document.addEventListener('keydown', (event) => {
            if (event.key !== '/' || event.defaultPrevented) return;

            const target = event.target;
            const isEditable = target instanceof HTMLElement
                && (target.isContentEditable
                    || ['INPUT', 'TEXTAREA', 'SELECT'].includes(target.tagName));

            if (isEditable) return;

            const searchInput = document.querySelector("input[name='q']");
            if (searchInput) {
                event.preventDefault();
                searchInput.focus();
            }
        });
    </script>

    {% block scripts %}{% endblock %}
</body>
</html>
